<!DOCTYPE html>
<html>
<head>
    <title>Edit Journal Entry</title>
</head>
<body>
    <h1>Edit Journal Entry</h1>

    <form action="{{ url_for('edit_entry', entry_id=entry._id) }}" method="post">
        <input type="hidden" name="entry_id" value="{{ entry._id }}">

        <div>
            <label for="date">Date:</label>
            <input type="date" id="date" name="date" value="{{ entry.get('date_str', '') }}" required>
        </div>
        <div>
            <label for="place_name">Place Name:</label>
             <input type="text" id="place_name" name="place_name" value="{{ entry.get('place_name', '') }}" required>
        </div>
        <div>
            <label for="place_address">Place Address:</label>
            <input type="text" id="place_address" name="place_address" value="{{ entry.get('place_address', '') }}" required>
        </div>
        <div>
            <label for="companions">Companions (comma-separated):</label>
            <input type="text" id="companions" name="companions" value="{{ entry.get('companions_str', '') }}">
        </div>
        
        <div>
            <label for="rating">Rating:</label>
            <div class="star-rating">
              <input type="hidden" id="rating" name="rating" value="0">
              <div class="stars">
                <span class="star" data-value="1"></span>
                <span class="star" data-value="2"></span>
                <span class="star" data-value="3"></span>
                <span class="star" data-value="4"></span>
                <span class="star" data-value="5"></span>
              </div>
            </div>
          </div>

         <div>
            <label for="category">Category:</label>
             <input type="text" id="category" name="category" value="{{ entry.get('category', '') }}">
        </div>
        <div>
            <label for="review">Review:</label>
             <textarea id="review" name="review" rows="4" required>{{ entry.get('review', '') }}</textarea>
        </div>

        <button type="submit">Update Entry</button>
    </form>

    <p>
        <a href="{{ url_for('my_entries') }}">Cancel</a>
        <form action="{{ url_for('delete_entry', entry_id=entry._id) }}" method="post" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this entry?');">Delete This Entry</button>
        </form>
    </p>


    <style>
        .star-rating {
            font-size: 2rem;
            color: lightgray;
            cursor: pointer;
            display: inline-block;
          }
          
          .star-rating .stars {
            display: flex;
            direction: ltr;
          }
          
          .star-rating .star {
            position: relative;
            width: 2rem; 
            height: 2rem;
          }
          
          .star-rating .star::before {
            content: "\2605"; 
            position: absolute;
            top: 0;
            left: 0;
            color: lightgray;
            font-size: 2rem;
            width: 100%;
            height: 100%;
            pointer-events: none;
          }
          
          .star-rating .star.full::before {
            color: gold;
          }
          
          .star-rating .star.half::before {
            background: linear-gradient(to right, gold 50%, lightgray 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          }
          
          </style>
          
            
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const stars = document.querySelectorAll('.star-rating .star');
                const ratingInput = document.getElementById('rating');
    
                stars.forEach((star, index) => {
                    star.addEventListener('mousemove', function(e) {
                    const rect = star.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const width = rect.width;
    
                    const isHalf = x < width / 2;
    
                    highlightStars(index, isHalf);
                    });
    
                    star.addEventListener('mouseleave', function() {
                    highlightStarsFromInput();
                    });
    
                    star.addEventListener('click', function(e) {
                    const rect = star.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const width = rect.width;
    
                    const value = index + (x < width / 2 ? 0.5 : 1);
                    ratingInput.value = value;
                    highlightStars(index, x < width / 2);
                    });
                });
    
                function highlightStars(index, isHalf) {
                    stars.forEach((star, i) => {
                    star.classList.remove('full', 'half');
                    if (i < index) {
                        star.classList.add('full');
                    } else if (i === index) {
                        star.classList.add(isHalf ? 'half' : 'full');
                    }
                    });
                }
    
                function highlightStarsFromInput() {
                    const value = parseFloat(ratingInput.value);
                    stars.forEach((star, i) => {
                    star.classList.remove('full', 'half');
                    if (i + 1 <= value) {
                        star.classList.add('full');
                    } else if (i + 0.5 === value) {
                        star.classList.add('half');
                    }
                    });
                }
                });
    
            </script>
</body>
</html>